{% extends "base.html" %}
{% load static %}

{% block main_content %}
<div class="row">
    <div class="col-lg-12">
        <h1 id="question"></h1>
        <p id="first"></p>
        <p id="second"></p>
        <p id="third"></p>
        <p id="fourth"></p>
        <p>TU BEDA PIERDOLONE SKURWYSYNSKIE PY TA NIA!!</p>
        {% if request.user.player.is_creator %}
            <input id="next" type="button" value="Next question">
        {% endif %}
    </div>
</div>

{{ room_name|json_script:"room-name" }}
<script>
    const roomName = JSON.parse(document.getElementById('room-name').textContent);

    const lobbySocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/game/'
        + roomName
        + '/'
    );

    lobbySocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        if (data['message'] === 'exit') {
            window.location.replace('/');
        }
    };

    lobbySocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#next').onkeyup = function(e) {
        if (e.keyCode === 13) {
                document.querySelector('#next').click();
        }
    };

    document.querySelector('#next').onclick = function(e) {
        lobbySocket.send(JSON.stringify({
            'message': {
                'event': 'start',
            }
        }));
    };
</script>
{% endblock %}
